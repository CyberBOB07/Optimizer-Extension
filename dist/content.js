(()=>{function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}function e(){var t=document.createElement("div");return t.className="tv-optimizer-window",t.style.cssText='\n        position: fixed;\n        top: 50px;\n        right: 50px;\n        background: #131722;\n        color: #d1d4dc;\n        border: 1px solid #363c4e;\n        border-radius: 3px;\n        padding: 8px;\n        z-index: 999;\n        min-width: 200px;\n        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n        font-size: 12px;\n        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;\n        user-select: none;\n    ',document.body.appendChild(t),r=t,n(t),x(t),t}function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r;if(t){var e=o();if(t.innerHTML='\n        <div class="content">\n            <div style="margin-bottom: 4px; color: #d1d4dc;">TradingView Optimizer</div>\n            <div style="font-size: 11px; opacity: 0.8; color: #787b86;">\n                <div>Symbol: '.concat(e.symbol,"</div>\n                <div>Interval: ").concat(e.interval,"</div>\n                <div>Settings: ").concat(l?"‚úÖ":"‚ùå","</div>\n                <div>Tracking: ").concat(a?"üîç":"‚è∏Ô∏è","</div>\n            </div>\n            ").concat(l?'\n                <div style="display: flex; gap: 4px; align-items: center; margin-top: 8px;">\n                    <button class="tv-optimizer-button" id="openSettingsButton" style="\n                        background: #2962ff;\n                        color: #fff;\n                        border: none;\n                        border-radius: 4px;\n                        padding: 6px 12px;\n                        cursor: pointer;\n                        font-size: 12px;\n                    ">\n                        Open Strategy Settings\n                    </button>\n                    <button class="tv-optimizer-button" id="resetButton" style="\n                        padding: 4px 8px;\n                        min-width: auto;\n                        background: #364250;\n                        color: #d1d4dc;\n                        border: 1px solid #4c525e;\n                        border-radius: 4px;\n                        cursor: pointer;\n                        font-size: 12px;\n                    " title="Detect button again">\n                        üîÑ\n                    </button>\n                </div>\n            ':'\n                <button class="tv-optimizer-button" id="trackButton" style="\n                    background: #2962ff;\n                    color: #fff;\n                    border: none;\n                    border-radius: 4px;\n                    padding: 6px 12px;\n                    margin-top: 8px;\n                    cursor: pointer;\n                    font-size: 12px;\n                ">\n                    '.concat(a?"Cancel Tracking":"Detect Settings Button","\n                </button>\n            "),"\n            ").concat(null!==d.netProfit?'\n                <div class="backtest-results" style="\n                    margin-top: 8px;\n                    padding-top: 8px;\n                    border-top: 1px solid #363c4e;\n                ">\n                    <div class="result-item" style="margin: 4px 0;">\n                        <span class="label" style="color: #787b86;">Net Profit:</span>\n                        <span class="value '.concat(m(d.netProfit),'" style="\n                            color: ').concat("positive"===m(d.netProfit)?"#089981":"negative"===m(d.netProfit)?"#f23645":"#d1d4dc",'\n                        ">\n                            ').concat(v(d.netProfit),"\n                            ").concat(d.netProfitPercent?"(".concat(g(d.netProfitPercent),")"):"",'\n                        </span>\n                    </div>\n                    <div class="result-item" style="margin: 4px 0;">\n                        <span class="label" style="color: #787b86;">Total Closed Trades:</span>\n                        <span class="value" style="color: #d1d4dc;">').concat(d.totalTrades||"‚Äî",'</span>\n                    </div>\n                    <div class="result-item" style="margin: 4px 0;">\n                        <span class="label" style="color: #787b86;">Percent Profitable:</span>\n                        <span class="value" style="color: #d1d4dc;">').concat(g(d.percentProfitable),'</span>\n                    </div>\n                    <div class="result-item" style="margin: 4px 0;">\n                        <span class="label" style="color: #787b86;">Profit Factor:</span>\n                        <span class="value ').concat(m(d.profitFactor-1),'" style="\n                            color: ').concat("positive"===m(d.profitFactor-1)?"#089981":"negative"===m(d.profitFactor-1)?"#f23645":"#d1d4dc",'\n                        ">').concat(u(d.profitFactor),'</span>\n                    </div>\n                    <div class="result-item" style="margin: 4px 0;">\n                        <span class="label" style="color: #787b86;">Max Drawdown:</span>\n                        <span class="value ').concat(m(-d.maxDrawdown),'" style="\n                            color: ').concat("positive"===m(-d.maxDrawdown)?"#089981":"negative"===m(-d.maxDrawdown)?"#f23645":"#d1d4dc",'\n                        ">\n                            ').concat(v(d.maxDrawdown),"\n                            ").concat(d.maxDrawdownPercent?"(".concat(g(d.maxDrawdownPercent),")"):"",'\n                        </span>\n                    </div>\n                    <div class="result-item" style="margin: 4px 0;">\n                        <span class="label" style="color: #787b86;">Avg Trade:</span>\n                        <span class="value ').concat(m(d.avgTrade),'" style="\n                            color: ').concat("positive"===m(d.avgTrade)?"#089981":"negative"===m(d.avgTrade)?"#f23645":"#d1d4dc",'\n                        ">\n                            ').concat(v(d.avgTrade),"\n                            ").concat(d.avgTradePercent?"(".concat(g(d.avgTradePercent),")"):"",'\n                        </span>\n                    </div>\n                    <div class="result-item" style="margin: 4px 0;">\n                        <span class="label" style="color: #787b86;">Avg # Bars in Trades:</span>\n                        <span class="value" style="color: #d1d4dc;">').concat(u(d.avgBarsInTrade,0),"</span>\n                    </div>\n                </div>\n            "):"","\n        </div>\n    "),l){var n=t.querySelector("#openSettingsButton");n&&n.addEventListener("click",f);var i=t.querySelector("#resetButton");i&&i.addEventListener("click",y)}else{var s=t.querySelector("#trackButton");s&&s.addEventListener("click",(function(){w(!a)}))}x(t)}else console.log("No window to update")}function o(){try{var t=document.querySelector('[data-name="legend-series-item"] [data-name="legend-source-title"]'),e=document.querySelector('button.title-l31H9iuA.accessible-l31H9iuA[aria-label="Change interval"]');return{symbol:t?t.textContent.trim():"–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω",interval:e?e.textContent.trim():"–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω"}}catch(t){return console.error("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:",t),{symbol:"–û—à–∏–±–∫–∞",interval:"–û—à–∏–±–∫–∞"}}}var r=null,a=!1,l=!1,i="",s=-1,c='button[title="Settings"].apply-common-tooltip',d={netProfit:null,netProfitPercent:null,totalTrades:null,percentProfitable:null,profitFactor:null,maxDrawdown:null,maxDrawdownPercent:null,avgTrade:null,avgTradePercent:null,avgBarsInTrade:null};function u(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return null==t||isNaN(t)?"‚Äî":t.toFixed(e)}function g(t){return null==t||isNaN(t)?"‚Äî":"".concat(t.toFixed(2),"%")}function v(t){return null==t||isNaN(t)?"‚Äî":"".concat(t.toFixed(2)," USDT")}function m(t){return null==t||isNaN(t)?"":t>0?"positive":t<0?"negative":""}function p(){console.log("Checking default settings button");var t=document.querySelector(c);return console.log("Default button found:",t),!!t&&(i=c,s=0,l=!0,chrome.storage.local.set({strategySettingsDetected:!0,strategySettingsSelector:i,strategyButtonIndex:s},(function(){console.log("Default settings button saved"),n()})),!0)}function f(){console.log("Trying to open strategy settings");var t=document.querySelector(c);if(console.log("Default settings button:",t),t)return console.log("Using default settings button"),b(t),!0;if(i&&i!==c){console.log("Trying to find settings button with selector:",i,"index:",s);var e=Array.from(document.querySelectorAll(i));if(console.log("Found buttons:",e.length),e.length>s){var n=e[s];return console.log("Using saved button:",n),b(n),!0}}return S("–ö–Ω–æ–ø–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –í–∫–ª—é—á–∞—é —Ä–µ–∂–∏–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è üîç"),w(!0),!1}function y(){console.log("Resetting settings"),l=!1,i="",s=-1,chrome.storage.local.set({strategySettingsDetected:!1,strategySettingsSelector:"",strategyButtonIndex:-1},(function(){console.log("Settings reset"),S("–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–±—Ä–æ—à–µ–Ω—ã ‚ú®"),r&&document.body.removeChild(r),e()}))}function b(t){console.log("Simulating click on element:",t);try{var e=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});t.dispatchEvent(e);var n=new MouseEvent("mousedown",{bubbles:!0,cancelable:!0,view:window}),o=new MouseEvent("mouseup",{bubbles:!0,cancelable:!0,view:window});t.dispatchEvent(n),t.dispatchEvent(o),t.click()}catch(t){console.error("Error simulating click:",t)}}function x(t){var e,n,o,r,a=!1,l=0,i=0;function s(e){"touchstart"===e.type?(o=e.touches[0].clientX-l,r=e.touches[0].clientY-i):(o=e.clientX-l,r=e.clientY-i),e.target===t&&(a=!0)}function c(){a&&(o=e,r=n,a=!1,chrome.storage.local.set({windowPosition:{top:t.style.top,right:t.style.right}}))}function d(s){a&&(s.preventDefault(),"touchmove"===s.type?(e=s.touches[0].clientX-o,n=s.touches[0].clientY-r):(e=s.clientX-o,n=s.clientY-r),l=e,i=n,t.style.transform="translate(".concat(e,"px, ").concat(n,"px)"))}t.addEventListener("touchstart",s,!1),t.addEventListener("touchend",c,!1),t.addEventListener("touchmove",d,!1),t.addEventListener("mousedown",s,!1),t.addEventListener("mouseup",c,!1),t.addEventListener("mousemove",d,!1)}function w(t){console.log("toggleTrackingMode:",t),a=t,t?(document.addEventListener("mousedown",h,!0),document.addEventListener("mouseup",h,!0),document.addEventListener("click",h,!0),S("–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ üéØ")):(document.removeEventListener("mousedown",h,!0),document.removeEventListener("mouseup",h,!0),document.removeEventListener("click",h,!0),S("–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ ‚è∏Ô∏è")),n()}function h(t){if(console.log("detectStrategySettings called, tracking mode:",a),a){var n=t.target;console.log("Click target:",n),console.log("Target attributes:",{class:n.className,dataName:n.getAttribute("data-name"),role:n.getAttribute("role"),ariaLabel:n.getAttribute("aria-label"),innerHTML:n.innerHTML});var o=n.closest('button.lightButton-bYDQcOkp.ghost-PVWoXu5j.gray-PVWoXu5j, [data-name="legend-settings-action"]');if(console.log("Found settings button:",o),o){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),t.returnValue=!1,i=o.matches("button.lightButton-bYDQcOkp.ghost-PVWoXu5j.gray-PVWoXu5j")?"button.lightButton-bYDQcOkp.ghost-PVWoXu5j.gray-PVWoXu5j":'[data-name="legend-settings-action"]';var c=Array.from(document.querySelectorAll(i)),d=c.indexOf(o);return console.log("Button index:",d,"of",c.length,"buttons"),s=d,console.log("Using selector:",i,"with index:",s),a=!1,document.removeEventListener("mousedown",h,!0),document.removeEventListener("mouseup",h,!0),document.removeEventListener("click",h,!0),console.log("Setting isStrategySettingsDetected to true"),l=!0,console.log("Recreating info window..."),r&&document.body.removeChild(r),e(),chrome.storage.local.set({strategySettingsDetected:!0,strategySettingsSelector:i,strategyButtonIndex:s},(function(){console.log("Settings saved to storage"),S("–ö–Ω–æ–ø–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É—Å–ø–µ—à–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞! ‚úÖ")})),!1}}}function S(t){var e=document.createElement("div");e.style.cssText='\n        position: fixed;\n        top: 20px;\n        left: 50%;\n        transform: translateX(-50%);\n        background: #131722;\n        color: #d1d4dc;\n        padding: 10px 20px;\n        border-radius: 4px;\n        z-index: 9999;\n        border: 1px solid #363c4e;\n        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;\n    ',e.textContent=t,document.body.appendChild(e),setTimeout((function(){e.remove()}),3e3)}function T(){console.log("Starting backtest results observer");var o=function(o){console.log("Processing backtest update, mutations:",o.length);var a,l=!1,i=function(e,n){var o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!o){if(Array.isArray(e)||(o=function(e,n){if(e){if("string"==typeof e)return t(e,n);var o={}.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?t(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){o&&(e=o);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,i=!0,s=!1;return{s:function(){o=o.call(e)},n:function(){var t=o.next();return i=t.done,t},e:function(t){s=!0,l=t},f:function(){try{i||null==o.return||o.return()}finally{if(s)throw l}}}}(o);try{for(i.s();!(a=i.n()).done;){var s=a.value;if("childList"===s.type){l=!0,console.log("Detected DOM structure change");break}if("characterData"===s.type){var c=s.target.parentElement;if(c&&(c.classList.contains("secondRow-Yvm0jjs7")||c.classList.contains("positiveValue-Yvm0jjs7")||c.classList.contains("negativeValue-Yvm0jjs7"))){l=!0,console.log("Detected value change in:",c);break}}}}catch(t){i.e(t)}finally{i.f()}if(l){console.log("Parsing updated results");var u=function(){console.log("Parsing backtest results"),r||(console.log("Creating missing info window"),e());var t=document.querySelector(".reportContainer-xOy3zRsH");if(!t)return console.log("Report container not found"),null;var o=t.querySelector(".container-Yvm0jjs7");if(!o)return console.log("Results container not found in report container"),null;var a=function(t){var e,n,r=Array.from(o.querySelectorAll(".containerCell-Yvm0jjs7")).find((function(e){var n;return(null===(n=e.querySelector(".title-Yvm0jjs7"))||void 0===n?void 0:n.textContent)===t}));if(!r)return console.log('Cell with title "'.concat(t,'" not found')),{main:null,additional:null};var a=r.querySelector(".secondRow-Yvm0jjs7");if(!a)return console.log('Second row not found for "'.concat(t,'"')),{main:null,additional:null};var l=a.querySelector("div:first-child"),i=null==l||null===(e=l.textContent)||void 0===e?void 0:e.trim(),s=a.querySelector(".additionalPercent-Yvm0jjs7"),c=null==s||null===(n=s.textContent)||void 0===n?void 0:n.trim();return console.log("Found values for ".concat(t,":"),{main:i,mainClass:null==l?void 0:l.className,additional:c,additionalClass:null==s?void 0:s.className}),{main:i,additional:c}},l=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!t)return null;var n=t.replace(/[\u2212\u2013\u2014‚àí]/g,"-");e&&(n=n.replace(" USDT","")),n=n.replace("%","").replace(/,/g,"");var o=parseFloat(n);return console.log("Parsing value:",{original:t,afterMinusReplacement:n,parsed:o,isNaN:isNaN(o)}),isNaN(o)?null:o},i=a("Net Profit"),s=a("Total Closed Trades"),c=a("Percent Profitable"),u=a("Profit Factor"),g=a("Max Drawdown"),v=a("Avg Trade"),m=a("Avg # Bars in Trades"),p={netProfit:l(i.main),netProfitPercent:l(i.additional),totalTrades:parseInt(s.main)||null,percentProfitable:l(c.main),profitFactor:l(u.main),maxDrawdown:l(g.main),maxDrawdownPercent:l(g.additional),avgTrade:l(v.main),avgTradePercent:l(v.additional),avgBarsInTrade:parseInt(m.main)||null},f=Object.values(p).some((function(t){return null!==t}));return f?(console.log("Valid results found:",p),d=p,r?(console.log("Updating existing info window"),n(r)):(console.log("Info window lost, creating new one"),e())):console.log("No valid results found"),f?p:null}();u&&(console.log("New results parsed:",u),n())}},a=new MutationObserver((function(t){clearTimeout(a.timeout),a.timeout=setTimeout((function(){o(t)}),100)})),l=function(){var t=function(){var t=document.querySelector(".reportContainer-xOy3zRsH");if(t)return console.log("Found report container"),t;var e=document.querySelector("#bottom-area");if(!e)return console.log("Bottom area not found"),null;var n=e.querySelector(".container-Yvm0jjs7");return n?(console.log("Found results container in bottom area"),n):(console.log("Results container not found"),null)}();t?(console.log("Starting observation of container"),a.observe(t,{childList:!0,subtree:!0,characterData:!0,attributes:!1}),o([{type:"childList"}])):(console.log("Container not found, retrying in 1 second"),setTimeout(l,1e3))};return l(),function(){console.log("Stopping backtest results observer"),clearTimeout(a.timeout),a.disconnect()}}chrome.runtime.onMessage.addListener((function(t,n,a){return"GET_TRADING_INFO"===t.type?a(o()):"TOGGLE_INFO_WINDOW"===t.type&&(t.show?r||(r=e()):r&&(updateInterval&&(clearInterval(updateInterval),updateInterval=null),r.remove(),r=null)),!0})),document.addEventListener("DOMContentLoaded",(function(){console.log("DOM loaded, checking settings button"),setTimeout((function(){l||p()}),2e3)})),setInterval((function(){l||p()}),5e3),chrome.storage.local.get(["strategyButtonIndex","strategySettingsDetected","strategySettingsSelector"],(function(t){console.log("Loaded storage:",t),t.strategySettingsDetected&&(l=!0,i=t.strategySettingsSelector,s=t.strategyButtonIndex,console.log("Restored settings selector:",i,"with index:",s)),e(),T()})),console.log("Initializing TradingView Optimizer..."),chrome.storage.local.get(["strategyButtonIndex","strategySettingsDetected","strategySettingsSelector"],(function(t){console.log("Loaded storage:",t),t.strategySettingsDetected&&(l=!0,i=t.strategySettingsSelector,s=t.strategyButtonIndex,console.log("Restored settings selector:",i,"with index:",s)),e(),T()})),document.addEventListener("DOMContentLoaded",(function(){console.log("DOM loaded, starting observers"),setTimeout(T,2e3)}))})();
//# sourceMappingURL=content.js.map