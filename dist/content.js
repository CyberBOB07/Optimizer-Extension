(()=>{function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}var t=!1,n=!1;function o(){if(i)return console.log("Window already exists, skipping creation"),i;console.log("Creating new info window");var e=document.createElement("div");return e.className="tv-optimizer-window",e.style.cssText='\n        position: fixed;\n        top: 50px;\n        right: 50px;\n        background: #131722;\n        color: #d1d4dc;\n        border: 1px solid #363c4e;\n        border-radius: 3px;\n        padding: 8px;\n        z-index: 999;\n        min-width: 200px;\n        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n        font-size: 12px;\n        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;\n        user-select: none;\n    ',document.body.appendChild(e),i=e,function(e){var t,n,o,r,a=!1,i=0,l=0;function s(t){"touchstart"===t.type?(o=t.touches[0].clientX-i,r=t.touches[0].clientY-l):(o=t.clientX-i,r=t.clientY-l),t.target===e&&(a=!0)}function c(){a&&(o=t,r=n,a=!1,chrome.storage.local.set({windowPosition:{top:e.style.top,right:e.style.right}}))}function d(s){a&&(s.preventDefault(),"touchmove"===s.type?(t=s.touches[0].clientX-o,n=s.touches[0].clientY-r):(t=s.clientX-o,n=s.clientY-r),i=t,l=n,e.style.transform="translate(".concat(t,"px, ").concat(n,"px)"))}e.addEventListener("touchstart",s,!1),e.addEventListener("touchend",c,!1),e.addEventListener("touchmove",d,!1),e.addEventListener("mousedown",s,!1),e.addEventListener("mouseup",c,!1),e.addEventListener("mousemove",d,!1)}(e),setTimeout((function(){return r(e)}),0),e}function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i;if(e){if(t)return console.log("Already updating, queuing next update"),void(n=!0);try{t=!0,console.log("Updating info window");var o=a(),c=g(),d=document.createElement("div");if(d.className="content",d.innerHTML='\n            <div style="margin-bottom: 4px; color: #d1d4dc;">TradingView Optimizer</div>\n            <div style="font-size: 11px; opacity: 0.8; color: #787b86;">\n                <div>Symbol: '.concat(o.symbol,"</div>\n                <div>Interval: ").concat(o.interval,"</div>\n                <div>Settings: ").concat(s?"‚úÖ":"‚ùå","</div>\n                <div>Tracking: ").concat(l?"üîç":"‚è∏Ô∏è","</div>\n            </div>\n            ").concat(s?'\n                <button class="tv-optimizer-button" id="openButton" style="\n                    background: #2962ff;\n                    color: #fff;\n                    border: none;\n                    border-radius: 2px;\n                    padding: 4px 8px;\n                    margin-top: 8px;\n                    cursor: pointer;\n                    font-size: 11px;\n                    width: 100%;\n                ">Open Strategy Settings</button>\n            ':'\n                <button class="tv-optimizer-button" id="detectButton" style="\n                    background: #2962ff;\n                    color: #fff;\n                    border: none;\n                    border-radius: 2px;\n                    padding: 4px 8px;\n                    margin-top: 8px;\n                    cursor: pointer;\n                    font-size: 11px;\n                    width: 100%;\n                ">Detect Settings Button</button>\n            ',"\n            ").concat(c?'\n                <div style="margin-top: 8px; border-top: 1px solid #363c4e; padding-top: 8px;">\n                    <div style="margin-bottom: 4px;">Backtest Results:</div>\n                    <div style="font-size: 11px;">\n                        <div>Net Profit: <span class="'.concat((b=c.netProfit,null==b||isNaN(b)?"":b>0?"positive":b<0?"negative":""),'">').concat(f(c.netProfit)," (").concat(v(c.netProfitPercent),")</span></div>\n                        <div>Total Trades: ").concat(c.totalTrades,"</div>\n                        <div>Percent Profitable: ").concat(v(c.percentProfitable),"</div>\n                        <div>Profit Factor: ").concat(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return null==e||isNaN(e)?"‚Äî":e.toFixed(t)}(c.profitFactor),"</div>\n                        <div>Max Drawdown: ").concat(f(c.maxDrawdown)," (").concat(v(c.maxDrawdownPercent),")</div>\n                        <div>Avg Trade: ").concat(f(c.avgTrade)," (").concat(v(c.avgTradePercent),")</div>\n                        <div>Avg # Bars: ").concat(c.avgBarsInTrade,"</div>\n                    </div>\n                </div>\n            "):"","\n        "),e.innerHTML="",e.appendChild(d),s){var u=e.querySelector("#openButton");u&&u.addEventListener("click",m)}else{var p=e.querySelector("#detectButton");p&&p.addEventListener("click",h)}}finally{t=!1,n&&(n=!1,r())}var b}else console.log("No window to update")}function a(){try{var e=document.querySelector('[data-name="legend-series-item"] [data-name="legend-source-title"]'),t=document.querySelector('button.title-l31H9iuA.accessible-l31H9iuA[aria-label="Change interval"]');return{symbol:e?e.textContent.trim():"–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω",interval:t?t.textContent.trim():"–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω"}}catch(e){return console.error("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:",e),{symbol:"–û—à–∏–±–∫–∞",interval:"–û—à–∏–±–∫–∞"}}}var i=null,l=!1,s=!1,c="",d=-1,u="button.lightButton-bYDQcOkp.noContent-bYDQcOkp.withStartSlot-bYDQcOkp.ghost-PVWoXu5j.gray-PVWoXu5j.small-bYDQcOkp";function g(){var e=document.querySelector(".container-Yvm0jjs7");if(!e)return console.log("Container not found"),null;try{var t=e.querySelectorAll(".containerCell-Yvm0jjs7");if(!t||0===t.length)return console.log("No cells found"),null;var n={};return t.forEach((function(e){var t,o,r,a=null===(t=e.querySelector(".title-Yvm0jjs7"))||void 0===t?void 0:t.textContent,i=null===(o=e.querySelector(".secondRow-Yvm0jjs7 div:first-child"))||void 0===o?void 0:o.textContent,l=null===(r=e.querySelector(".additionalPercent-Yvm0jjs7"))||void 0===r?void 0:r.textContent;if(a&&i)switch(a.trim()){case"Net Profit":n.netProfit=parseFloat(i.replace(/[^0-9.-]/g,"")),l&&(n.netProfitPercent=parseFloat(l.replace(/[^0-9.-]/g,"")));break;case"Total Closed Trades":n.totalTrades=parseInt(i);break;case"Percent Profitable":n.percentProfitable=parseFloat(i.replace("%",""));break;case"Profit Factor":n.profitFactor=parseFloat(i);break;case"Max Drawdown":n.maxDrawdown=parseFloat(i.replace(/[^0-9.-]/g,"")),l&&(n.maxDrawdownPercent=parseFloat(l.replace(/[^0-9.-]/g,"")));break;case"Avg Trade":n.avgTrade=parseFloat(i.replace(/[^0-9.-]/g,"")),l&&(n.avgTradePercent=parseFloat(l.replace(/[^0-9.-]/g,"")));break;case"Avg # Bars in Trades":n.avgBarsInTrade=parseFloat(i)}})),void 0!==n.netProfit&&void 0!==n.totalTrades?(console.log("Results parsed successfully:",n),n):(console.log("Not all required results found"),null)}catch(e){return console.error("Error parsing results:",e),null}}function v(e){return null==e||isNaN(e)?"‚Äî":"".concat(e.toFixed(2),"%")}function f(e){return null==e||isNaN(e)?"‚Äî":"".concat(e.toFixed(2)," USDT")}function p(){console.log("Checking default settings button");var e=document.querySelector(u);return console.log("Default button found:",e),!!e&&(c=u,d=0,s=!0,chrome.storage.local.set({strategySettingsDetected:!0,strategySettingsSelector:c,strategyButtonIndex:d},(function(){console.log("Default settings button saved"),r()})),!0)}function m(){console.log("Trying to open strategy settings");var e,t=document.querySelector(u);if(console.log("Default settings button:",t),t)return console.log("Using default settings button"),b(t),!0;if(c&&c!==u){console.log("Trying to find settings button with selector:",c,"index:",d);var n=Array.from(document.querySelectorAll(c));if(console.log("Found buttons:",n.length),n.length>d){var o=n[d];return console.log("Using saved button:",o),b(o),!0}}return w("–ö–Ω–æ–ø–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –í–∫–ª—é—á–∞—é —Ä–µ–∂–∏–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è "),e=!0,console.log("toggleTrackingMode:",e),l=e,document.addEventListener("mousedown",h,!0),document.addEventListener("mouseup",h,!0),document.addEventListener("click",h,!0),w("–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ "),r(),!1}function b(e){console.log("Simulating click on element:",e);try{var t=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});e.dispatchEvent(t);var n=new MouseEvent("mousedown",{bubbles:!0,cancelable:!0,view:window}),o=new MouseEvent("mouseup",{bubbles:!0,cancelable:!0,view:window});e.dispatchEvent(n),e.dispatchEvent(o),e.click()}catch(e){console.error("Error simulating click:",e)}}function y(){console.log("Showing info window"),i?(console.log("Window already exists, updating"),r()):o()&&(console.log("Window created successfully"),D())}function h(e){if(console.log("detectStrategySettings called, tracking mode:",l),l){var t=e.target;console.log("Click target:",t),console.log("Target attributes:",{class:t.className,dataName:t.getAttribute("data-name"),role:t.getAttribute("role"),ariaLabel:t.getAttribute("aria-label"),innerHTML:t.innerHTML});var n=t.closest('button.lightButton-bYDQcOkp.noContent-bYDQcOkp.withStartSlot-bYDQcOkp.ghost-PVWoXu5j.gray-PVWoXu5j.small-bYDQcOkp, [data-name="legend-settings-action"]');return console.log("Found settings button:",n),n?(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),e.returnValue=!1,c=n.matches("button.lightButton-bYDQcOkp.noContent-bYDQcOkp.withStartSlot-bYDQcOkp.ghost-PVWoXu5j.gray-PVWoXu5j.small-bYDQcOkp")?"button.lightButton-bYDQcOkp.noContent-bYDQcOkp.withStartSlot-bYDQcOkp.ghost-PVWoXu5j.gray-PVWoXu5j.small-bYDQcOkp":'[data-name="legend-settings-action"]',console.log("Using selector:",c),l=!1,document.removeEventListener("mousedown",h,!0),document.removeEventListener("mouseup",h,!0),document.removeEventListener("click",h,!0),console.log("Setting isStrategySettingsDetected to true"),s=!0,console.log("Recreating info window..."),i&&document.body.removeChild(i),o(),chrome.storage.local.set({strategySettingsDetected:!0,strategySettingsSelector:c,strategyButtonIndex:d},(function(){console.log("Settings saved to storage"),w("–ö–Ω–æ–ø–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É—Å–ø–µ—à–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞! ")})),!1):void 0}}function w(e){var t=document.createElement("div");t.style.cssText='\n        position: fixed;\n        top: 20px;\n        left: 50%;\n        transform: translateX(-50%);\n        background: #131722;\n        color: #d1d4dc;\n        padding: 10px 20px;\n        border-radius: 4px;\n        z-index: 9999;\n        border: 1px solid #363c4e;\n        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;\n    ',t.textContent=e,document.body.appendChild(t),setTimeout((function(){t.remove()}),3e3)}chrome.runtime.onMessage.addListener((function(e,t,n){if(console.log("Received message:",e),"GET_TRADING_INFO"===e.type)n(a());else if("TOGGLE_INFO_WINDOW"===e.type){console.log("Toggle info window:",e.show);try{e.show?y():(console.log("Hiding info window"),i&&(x&&(x.disconnect(),x=null),k&&(clearInterval(k),k=null),i.remove(),i=null)),n({success:!0})}catch(e){console.error("Error toggling window:",e),n({success:!1,error:e.message})}}return!0})),chrome.storage.local.get(["strategyButtonIndex","strategySettingsDetected","strategySettingsSelector","showInfoWindow"],(function(e){console.log("Loaded storage:",e),e.strategySettingsDetected&&(s=!0,c=e.strategySettingsSelector,d=e.strategyButtonIndex,console.log("Restored settings selector:",c,"with index:",d)),(void 0===e.showInfoWindow||e.showInfoWindow)&&y(),D();var t=location.href,n="",o="";setInterval((function(){var e=location.href,l=a();e!==t&&(console.log("URL changed:",e),t=e,s||setTimeout(p,2e3),D()),l.symbol===n&&l.interval===o||(console.log("Symbol or interval changed:",l.symbol,l.interval),n=l.symbol,o=l.interval,i&&r())}),1e3)})),document.addEventListener("DOMContentLoaded",(function(){console.log("DOM loaded, checking settings button"),setTimeout((function(){s||p()}),2e3)})),setInterval((function(){s||p()}),5e3),console.log("Initializing TradingView Optimizer..."),chrome.storage.local.get(["strategyButtonIndex","strategySettingsDetected","strategySettingsSelector","showInfoWindow"],(function(e){console.log("Loaded storage:",e),e.strategySettingsDetected&&(s=!0,c=e.strategySettingsSelector,d=e.strategyButtonIndex,console.log("Restored settings selector:",c,"with index:",d)),(void 0===e.showInfoWindow||e.showInfoWindow)&&y(),D(),s||setTimeout(p,2e3)}));var x=null,S=null,k=null;function D(){S&&(clearInterval(S),S=null),console.log("Starting to wait for backtest results"),S=setInterval((function(){var t=document.querySelector(".container-Yvm0jjs7");if(t)if(null!==t.offsetParent){var n=g();n?(console.log("Backtest results found:",n),clearInterval(S),S=null,function(){k&&(clearInterval(k),k=null),x&&(x.disconnect(),x=null),console.log("Starting backtest observer");var t=function(t){if(t){var o=t.querySelectorAll(".positiveValue-Yvm0jjs7, .negativeValue-Yvm0jjs7, .additionalPercent-Yvm0jjs7");console.log("Found value elements:",o.length),x&&x.disconnect(),x=new MutationObserver((function(t){var o,r=!1,a=function(t,n){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function(t,n){if(t){if("string"==typeof t)return e(t,n);var o={}.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?e(t,n):void 0}}(t))||n&&t&&"number"==typeof t.length){o&&(t=o);var r=0,a=function(){};return{s:a,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,l=!0,s=!1;return{s:function(){o=o.call(t)},n:function(){var e=o.next();return l=e.done,e},e:function(e){s=!0,i=e},f:function(){try{l||null==o.return||o.return()}finally{if(s)throw i}}}}(t);try{for(a.s();!(o=a.n()).done;){var l=o.value;if("characterData"===l.type){var s=l.target.parentElement;s&&(s.classList.contains("positiveValue-Yvm0jjs7")||s.classList.contains("negativeValue-Yvm0jjs7")||s.classList.contains("additionalPercent-Yvm0jjs7"))&&(console.log("Value changed:",{element:s.className,oldValue:l.oldValue,newValue:l.target.textContent}),r=!0)}}}catch(e){a.e(e)}finally{a.f()}r&&i&&(console.log("Updating info window due to value changes"),n())})),o.forEach((function(e){x.observe(e,{characterData:!0,characterDataOldValue:!0,subtree:!0})})),x.observe(t,{childList:!0,subtree:!0}),n()}},n=function(){var e=g();e&&i&&(console.log("Updating results:",e),r())},o=function(){var e=document.querySelector(".container-Yvm0jjs7");return e?(console.log("Found backtest results container"),t(e),!0):(console.log("Container not found"),!1)};k=setInterval((function(){document.querySelector(".container-Yvm0jjs7")?g()&&(console.log("Container exists, checking for updates"),n()):(console.log("Searching for container..."),o())}),500),o()}(),i&&r()):console.log("Results not ready yet...")}else console.log("Container is hidden, waiting...");else console.log("Waiting for container...")}),500),setTimeout((function(){S&&(console.log("Timeout waiting for backtest results"),clearInterval(S),S=null)}),1e4)}})();
//# sourceMappingURL=content.js.map